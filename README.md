# Tag-o-mancer.
p2p-сеть для хранения и обмена файлами.

## Основная информация.
Данный проект предполагает создание p2p-сети с сервером-координатором.
Сервер-координатор регистрирует клиентов и содержит информацию об активных клиентах.
Клиент хранит информацию о файлах на диске и позволяет производить поиск среди других клиентов.

## Сервер.
Основной функционал сервера - регистрация клиентов и выдача информации об активных клиентах для других пользователей.

Сервер выполнен с использованием Django и субд PostgreSQL.

### Модели БД

**User** - стандартная модель Django для пользователей.

**Address** - информация о клиенте.

  Поля:

  - IP - последний ip, с которого сообщал о себе клиент.
  - User - Внешний ключ для таблицы User.
  - Last_checked - Дата последнего сообщения от клиента.
  - Is_online - Считается ли пользователь онлайн (в зависимости от времени).

### Endpoint-ы, предоставляемые сервером.

**Регистрация. /register** <br/>
Веб-форма, позволяет зарегистрироваться (стандартная Django-форма регистрации).

**Аутентификация. POST /auth** <br/> 
Используется для аутентификации пользователя. В ответ возвращает пользователю токен, по которому и производится дальнейшее подтверждение пользователя.

Пример запроса:
```
POST 127.0.0.1:8030/auth
{
 'username': 'user_2'
 'password': 'pass' 
}
```

Ответ:
```
200 OK
{
  'token': '8424c260f9523f8e4398fb2d8d0236626130ec5f'
}
```


**Получение отклика от клиента. /ping** <br/>
Используется клиентами для сообщения своего текущего адреса.
Записывает адрес, с которого пришел запрос и фиксирует время запроса.

Пример запроса:
```
GET 127.0.0.1:8030/ping
```

Ответ:
```
200 OK
```
 
**Предоставление информации об доступных клиентах. /online** <br/>
Используется клиентом для поиска данных в сети.

Пример запроса:
```
GET 127.0.0.1:8030/online
```

Ответ:
```
200 OK
{
    "available": [
        { 
            "user": "user_2",
            "address": "127.0.0.1"
        },
        {
            "user": "user_1",
            "address": "127.0.0.1"
        }
    ]
}
```



## Клиент
Клиент является основной единицей приложения. <br/>
Его функционал включает три части:
1. Работа с сервером - регистрация, авторизация.
2. Работа с локальным хранилищем - добавление/изменение мест хранения, анализ и сохранение файлов, предоставление доступа для других клиентов.
3. Поиск и загрузка файлов среди других клиентов. 

Клиент выполнен с использованием Django и субд PostgreSQL.

### Модели БД.
**Storage** - информация о местах хранения файлов для обмена.
Включает в себя автоматически папку /media. Остальные локации добавляются пользователем.

Path - локальный адрес хранилища.<br/>
Date - дата добавления. <br/>
Hidden - флаг, определяет, видима ли локация для внешних пользователей <br/>

**File** - информация о доступных файлах. Обновляется при добавлении/удалении хранилищ, а так же вручную.

Name - Название файла <br/>
Path - Полный путь до файла <br/>
File_hash - Хеш файла - используется для обмена <br/>
Storage - Внешний ключ для Storage<br/>
Hidden - Флаг, определяет, видим ли конкретный файл для внешних пользователей<br/>
Size - Размер файла <br/>

**Settings** - общая таблица для хранения настроек приложения.

Name - Название настройки <br/>
Value - Значение <br/>

### Функционал, предоставляемый клиентом
**Главная страница**

На данной странице отображаются основные разделы.<br/>
Также видно два блока - текущее состояние связи с сервером и блок авторизации.<br/>

![main_page](/readme_images/main_page.PNG)

**Редактирование настроек сервера**

Блок настроек сервера отображается на любой странице.<br/>
В нем отображается статус связи - Online/Offline, а так же пользователь, под которым производится работа с сервером.<br/>

![server_status_online](/readme_images/server_status_1.PNG)

![server_status_offline](/readme_images/server_status_2.PNG)

Страница редактирования настроек сервера позволяет указать данные - адрес сервера, пользователь и пароль для авторизации.<br/>
После указания данных они будут сохранены в настройки, выполнен запрос на сервер (/auth) и сохранен токен, полученный от сервера.  

![server_login](/readme_images/server_login.PNG)

**Авторизация**

Блок авторизации отображается на любой странице.<br/>
В нем отображается текущий пользователь, под которым происходит работа.<br/>

![user_status_online](/readme_images/user_status_1.PNG)

![user_status_offline](/readme_images/user_status_2.PNG)

Страница авторизации для пользователей.

![user_login](/readme_images/user_login.PNG)

**Работа с хранилищами**

На данной странице отображаются все текущие хранилища и операции над ними.<br/>
Скрытые хранилища помечены серым цветом.<br/>

![storages](/readme_images/storage.PNG)

**Локальные файлы**

На данной странице отображаются файлы, доступные в текущих хранилищах.<br/>
Скрытые файлы помечены серым цветом.<br/>
Также есть возможность загрузить файл из локального хранилища через веб-интерфейс<br/>

![local_files](/readme_images/local_files.PNG)

На форме доступна возможность поиска по имени файла

![local_files_search](/readme_images/local_files_2.PNG)

**Файлы в сети**

Данная страница отображает интерфейс поиска в сети.<br/>
При открытии отображается только строка поиска.<br/>

![outer_files_empty](/readme_images/outer_files_1.PNG)

Поиск выполняется среди всех доступных клиентов. По завершению поиска собирается информация о файлах - адрес клиента, размер и хэш.<br/>

![outer_files_search](/readme_images/outer_files_2.PNG)

Для найденых файлов есть два варианта - их можно загрузить в хранилище клиента (всегда доступное хранилище в папке /media) или скачать прямо через веб-интерфейс.

![outer_files_load](/readme_images/outer_files_3.PNG)

Диаграма последовательности при поиске и загрузке файла.

![scheme](/readme_images/scheme.png)

Запросы для работы с файлами.

Поиск файлов.
```
GET 127.0.0.1:8031/search?search_str=1
```
Ответ.
```
200 OK
{
    "files": [
        {
            "name": "1.txt",
            "size": 216654,
            "file_hash": "30bff813f3b822bc62bd97df60b2d6e88c1019440177fde359fae34b811a604f"
        },
        {
            "name": "123.txt",
            "size": 27,
            "file_hash": "c6f00ba6593c185114005924ec4cdac42a10b1ec88a330a16927971a33ef2def"
        },
        {
            "name": "12.txt",
            "size": 27,
            "file_hash": "c6f00ba6593c185114005924ec4cdac42a10b1ec88a330a16927971a33ef2def"
        }
    ]
}
```

Загрузка файла
```
GET 127.0.0.1:8031/getfile?name=123.txt&file_hash=c6f00ba6593c185114005924ec4cdac42a10b1ec88a330a16927971a33ef2def
```
Ответ
```
200 OK

qweqwe
asdasd
zxczxczxczxc
```

## Дальнейшие планы по развитию.

### Добавление групп доступа.

Добавить возможность указывать доступ к файлам для конкретных пользователей или групп пользователей.<br/>
Пользователь может зарегистрировать группу на сервере и рассылать приглашения другим пользователям.<br/>
При получении списка активных клиентов пользователь так же получает возможность узнать, к каким группам принадлежат пользователи.<br/>

### Добавление системы тегов.

Переработать систему работы с файлами.<br/>
Сервер хранит список тегов.<br/>
Пользователи "обрамляют" файлы тегами - массово или индивидуально.<br/>
Теги бывают различных типов.<br/>
Поиск файлов в сети происходит по тегам.<br/>
Пользователи могут добавлять новые теги и сихнронизировать их с сервером.<br/>

### Добавление возможности использовать клиент как медиа-центр с веб-интерфейсом.

Каждый файл с медиа-контентом можно воспроизводить через сеть без загрузки.<br/>
